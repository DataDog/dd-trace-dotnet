version: '3'
services:
  # This extends the version in docker-compose.yml, by adding the extra depends_on for the serverless images
  IntegrationTests.Serverless:
    depends_on:
    - serverless-lambda-no-param-sync
    - serverless-lambda-one-param-sync
    - serverless-lambda-two-params-sync    
    - serverless-lambda-no-param-sync-with-context
    - serverless-lambda-one-param-sync-with-context
    - serverless-lambda-two-params-sync-with-context
    - serverless-lambda-no-param-async
    - serverless-lambda-one-param-async
    - serverless-lambda-two-params-async    
    - serverless-lambda-no-param-void
    - serverless-lambda-one-param-void
    - serverless-lambda-two-params-void
    - serverless-lambda-base-no-param-sync
    - serverless-lambda-base-two-params-sync
    - serverless-lambda-base-one-param-sync-with-context
    - serverless-lambda-base-one-param-async
    - serverless-lambda-base-two-params-void
    - serverless-lambda-struct-param
    - serverless-lambda-nested-class-param
    - serverless-lambda-nested-struct-param
    - serverless-lambda-generic-dict-param
    - serverless-lambda-nested-generic-dict-param
    - serverless-lambda-doubly-nested-generic-dict-param
    - serverless-lambda-throwing
    - serverless-lambda-throwing-async
    - serverless-lambda-throwing-async-task
    - serverless-lambda-throwing-with-context
    - serverless-lambda-throwing-async-with-context
    - serverless-lambda-throwing-async-task-with-context
    - serverless-lambda-generic
    - serverless-lambda-generic-async
    - serverless-lambda-generic-virtual
    - serverless-lambda-generic-virtual-async
    - serverless-lambda-generic-abstract
    - serverless-lambda-generic-abstract-async
    - serverless-lambda-generic-complex
    - serverless-lambda-generic-complex-nested
    - serverless-lambda-toplevel-statement
    - serverless-dummy-api
    environment:
    - AWS_LAMBDA_ENDPOINT_NO_PARAM_SYNC=http://serverless-lambda-no-param-sync:8080
    - AWS_LAMBDA_ENDPOINT_ONE_PARAM_SYNC=http://serverless-lambda-one-param-sync:8080
    - AWS_LAMBDA_ENDPOINT_TWO_PARAMS_SYNC=http://serverless-lambda-two-params-sync:8080
    - AWS_LAMBDA_ENDPOINT_NO_PARAM_SYNC_WITH_CONTEXT=http://serverless-lambda-no-param-sync-with-context:8080
    - AWS_LAMBDA_ENDPOINT_ONE_PARAM_SYNC_WITH_CONTEXT=http://serverless-lambda-one-param-sync-with-context:8080
    - AWS_LAMBDA_ENDPOINT_TWO_PARAMS_SYNC_WITH_CONTEXT=http://serverless-lambda-two-params-sync-with-context:8080
    - AWS_LAMBDA_ENDPOINT_NO_PARAM_ASYNC=http://serverless-lambda-no-param-async:8080
    - AWS_LAMBDA_ENDPOINT_ONE_PARAM_ASYNC=http://serverless-lambda-one-param-async:8080
    - AWS_LAMBDA_ENDPOINT_TWO_PARAMS_ASYNC=http://serverless-lambda-two-params-async:8080
    - AWS_LAMBDA_ENDPOINT_NO_PARAM_VOID=http://serverless-lambda-no-param-void:8080
    - AWS_LAMBDA_ENDPOINT_ONE_PARAM_VOID=http://serverless-lambda-one-param-void:8080
    - AWS_LAMBDA_ENDPOINT_TWO_PARAMS_VOID=http://serverless-lambda-two-params-void:8080
    - AWS_LAMBDA_ENDPOINT_BASE_NO_PARAM_SYNC=http://serverless-lambda-base-no-param-sync:8080
    - AWS_LAMBDA_ENDPOINT_BASE_TWO_PARAMS_SYNC=http://serverless-lambda-base-two-params-sync:8080
    - AWS_LAMBDA_ENDPOINT_BASE_ONE_PARAM_SYNC_WITH_CONTEXT=http://serverless-lambda-base-one-param-sync-with-context:8080
    - AWS_LAMBDA_ENDPOINT_BASE_ONE_PARAM_ASYNC=http://serverless-lambda-base-one-param-async:8080
    - AWS_LAMBDA_ENDPOINT_BASE_TWO_PARAMS_VOID=http://serverless-lambda-base-two-params-void:8080
    - AWS_LAMBDA_ENDPOINT_STRUCT_PARAM=http://serverless-lambda-struct-param:8080
    - AWS_LAMBDA_ENDPOINT_NESTED_CLASS_PARAM=http://serverless-lambda-nested-class-param:8080
    - AWS_LAMBDA_ENDPOINT_NESTED_STRUCT_PARAM=http://serverless-lambda-nested-struct-param:8080
    - AWS_LAMBDA_ENDPOINT_GENERIC_DICT_PARAM=http://serverless-lambda-generic-dict-param:8080
    - AWS_LAMBDA_ENDPOINT_NESTED_GENERIC_DICT_PARAM=http://serverless-lambda-nested-generic-dict-param:8080
    - AWS_LAMBDA_ENDPOINT_DOUBLY_NESTED_GENERIC_DICT_PARAM=http://serverless-lambda-doubly-nested-generic-dict-param:8080
    - AWS_LAMBDA_ENDPOINT_THROWING=http://serverless-lambda-throwing:8080
    - AWS_LAMBDA_ENDPOINT_THROWING_ASYNC=http://serverless-lambda-throwing-async:8080
    - AWS_LAMBDA_ENDPOINT_THROWING_ASYNC_TASK=http://serverless-lambda-throwing-async-task:8080
    - AWS_LAMBDA_ENDPOINT_THROWING_WITH_CONTEXT=http://serverless-lambda-throwing-with-context:8080
    - AWS_LAMBDA_ENDPOINT_THROWING_ASYNC_WITH_CONTEXT=http://serverless-lambda-throwing-async-with-context:8080
    - AWS_LAMBDA_ENDPOINT_THROWING_ASYNC_TASK_WITH_CONTEXT=http://serverless-lambda-throwing-async-task-with-context:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE=http://serverless-lambda-generic:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE_ASYNC=http://serverless-lambda-generic-async:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE_VIRTUAL=http://serverless-lambda-generic-virtual:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE_VIRTUAL_ASYNC=http://serverless-lambda-generic-virtual-async:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE_ABSTRACT=http://serverless-lambda-generic-abstract:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE_ABSTRACT_ASYNC=http://serverless-lambda-generic-abstract-async:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE_COMPLEX=http://serverless-lambda-generic-complex:8080
    - AWS_LAMBDA_ENDPOINT_GENERICBASE_COMPLEX_NESTED=http://serverless-lambda-generic-complex-nested:8080
    - AWS_LAMBDA_ENDPOINT_TOPLEVEL_STATEMENT=http://serverless-lambda-toplevel-statement:8080
    - DUMMY_API_HOST=http://serverless-dummy-api:9005

  StartDependencies.Serverless:
    image: andrewlock/wait-for-dependencies
    depends_on:
    - serverless-lambda-no-param-sync
    - serverless-lambda-one-param-sync
    - serverless-lambda-two-params-sync
    - serverless-lambda-no-param-sync-with-context
    - serverless-lambda-one-param-sync-with-context
    - serverless-lambda-two-params-sync-with-context
    - serverless-lambda-no-param-async
    - serverless-lambda-one-param-async
    - serverless-lambda-two-params-async
    - serverless-lambda-no-param-void
    - serverless-lambda-one-param-void
    - serverless-lambda-two-params-void
    - serverless-lambda-base-no-param-sync
    - serverless-lambda-base-two-params-sync
    - serverless-lambda-base-one-param-sync-with-context
    - serverless-lambda-base-one-param-async
    - serverless-lambda-base-two-params-void
    - serverless-lambda-struct-param
    - serverless-lambda-nested-class-param
    - serverless-lambda-nested-struct-param
    - serverless-lambda-generic-dict-param
    - serverless-lambda-nested-generic-dict-param
    - serverless-lambda-doubly-nested-generic-dict-param
    - serverless-lambda-throwing
    - serverless-lambda-throwing-async
    - serverless-lambda-throwing-async-task
    - serverless-lambda-throwing-with-context
    - serverless-lambda-throwing-async-with-context
    - serverless-lambda-throwing-async-task-with-context
    - serverless-lambda-generic
    - serverless-lambda-generic-async
    - serverless-lambda-generic-virtual
    - serverless-lambda-generic-virtual-async
    - serverless-lambda-generic-abstract
    - serverless-lambda-generic-abstract-async
    - serverless-lambda-generic-complex
    - serverless-lambda-generic-complex-nested
    - serverless-lambda-toplevel-statement
    - serverless-dummy-api
    environment:
      - TIMEOUT_LENGTH=120
    command: |
      serverless-lambda-no-param-sync:8080
      serverless-lambda-one-param-sync:8080
      serverless-lambda-two-params-sync:8080
      serverless-lambda-no-param-sync-with-context:8080
      serverless-lambda-one-param-sync-with-context:8080
      serverless-lambda-two-params-sync-with-context:8080
      serverless-lambda-no-param-async:8080
      serverless-lambda-one-param-async:8080
      serverless-lambda-two-params-async:8080
      serverless-lambda-no-param-void:8080
      serverless-lambda-one-param-void:8080
      serverless-lambda-two-params-void:8080
      serverless-lambda-base-no-param-sync:8080
      serverless-lambda-base-two-params-sync:8080
      serverless-lambda-base-one-param-sync-with-context:8080
      serverless-lambda-base-one-param-async:8080
      serverless-lambda-base-two-params-void:8080
      serverless-lambda-struct-param:8080
      serverless-lambda-nested-class-param:8080
      serverless-lambda-nested-struct-param:8080
      serverless-lambda-generic-dict-param:8080
      serverless-lambda-nested-generic-dict-param:8080
      serverless-lambda-doubly-nested-generic-dict-param:8080
      serverless-lambda-throwing:8080
      serverless-lambda-throwing-async:8080
      serverless-lambda-throwing-async-task:8080
      serverless-lambda-throwing-with-context:8080
      serverless-lambda-throwing-async-with-context:8080
      serverless-lambda-throwing-async-task-with-context:8080
      serverless-lambda-generic:8080
      serverless-lambda-generic-async:8080
      serverless-lambda-generic-virtual:8080
      serverless-lambda-generic-virtual-async:8080
      serverless-lambda-generic-abstract:8080
      serverless-lambda-generic-abstract-async:8080
      serverless-lambda-generic-complex:8080
      serverless-lambda-generic-complex-nested:8080
      serverless-lambda-toplevel-statement:8080
      serverless-dummy-api:9005

  serverless-lambda-no-param-sync:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerNoParamSync"
    image: dd-trace-dotnet/serverless-lambda-no-param-sync
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-no-param-sync:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-one-param-sync:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerOneParamSync"
    image: dd-trace-dotnet/serverless-lambda-one-param-sync
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-one-param-sync:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-two-params-sync:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerTwoParamsSync"
    image: dd-trace-dotnet/serverless-lambda-two-params-sync
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-two-params-sync:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-no-param-sync-with-context:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerNoParamSyncWithContext"
    image: dd-trace-dotnet/serverless-lambda-no-param-sync-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9004
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-no-param-sync-with-context:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-one-param-sync-with-context:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerOneParamSyncWithContext"
    image: dd-trace-dotnet/serverless-lambda-one-param-sync-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9004
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-one-param-sync-with-context:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-two-params-sync-with-context:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerTwoParamsSyncWithContext"
    image: dd-trace-dotnet/serverless-lambda-two-params-sync-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9004
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-two-params-sync-with-context:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-no-param-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerNoParamAsync"
    image: dd-trace-dotnet/serverless-lambda-two-params-sync-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-no-param-async:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-one-param-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerOneParamAsync"
    image: dd-trace-dotnet/serverless-lambda-one-param-async
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-one-param-async:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-two-params-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerTwoParamsAsync"
    image: dd-trace-dotnet/serverless-lambda-two-params-async
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-two-params-async:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-no-param-void:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerNoParamVoid"
    image: dd-trace-dotnet/serverless-lambda-no-param-void
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-no-param-void:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-one-param-void:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerOneParamVoid"
    image: dd-trace-dotnet/serverless-lambda-one-param-void
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-one-param-void:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-two-params-void:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerTwoParamsVoid"
    image: dd-trace-dotnet/serverless-lambda-two-params-void
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-two-params-void:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps
  
  serverless-lambda-base-no-param-sync:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::BaseHandlerNoParamSync"
    image: dd-trace-dotnet/serverless-lambda-base-no-param-sync
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-base-no-param-sync:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-base-two-params-sync:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::BaseHandlerTwoParamsSync"
    image: dd-trace-dotnet/serverless-lambda-base-two-params-sync
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-base-two-params-sync:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-base-one-param-sync-with-context:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::BaseHandlerOneParamSyncWithContext"
    image: dd-trace-dotnet/serverless-lambda-base-one-param-sync-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9004
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-base-one-param-sync-with-context:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-base-one-param-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::BaseHandlerOneParamAsync"
    image: dd-trace-dotnet/serverless-lambda-base-one-param-async
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-base-one-param-async:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-base-two-params-void:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::BaseHandlerTwoParamsVoid"
    image: dd-trace-dotnet/serverless-lambda-base-two-params-void
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-base-two-params-void:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-struct-param:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerStructParam"
    image: dd-trace-dotnet/serverless-lambda-struct-param
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-struct-param:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-nested-class-param:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerNestedClassParam"
    image: dd-trace-dotnet/serverless-lambda-nested-class-param
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-nested-class-param:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-nested-struct-param:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerNestedStructParam"
    image: dd-trace-dotnet/serverless-lambda-nested-struct-param
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-nested-struct-param:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-dict-param:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerGenericDictionaryParam"
    image: dd-trace-dotnet/serverless-lambda-generic-dict-param
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-generic-dict-param:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-nested-generic-dict-param:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerNestedGenericDictionaryParam"
    image: dd-trace-dotnet/serverless-lambda-nested-generic-dict-param
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-nested-generic-dict-param:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-doubly-nested-generic-dict-param:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::HandlerDoublyNestedGenericDictionaryParam"
    image: dd-trace-dotnet/serverless-lambda-doubly-nested-generic-dict-param
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-doubly-nested-generic-dict-param:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-throwing:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::ThrowingHandler"
    image: dd-trace-dotnet/serverless-lambda-throwing
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-throwing:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-throwing-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::ThrowingHandlerAsync"
    image: dd-trace-dotnet/serverless-lambda-throwing-async
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-throwing-async:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-throwing-async-task:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::ThrowingHandlerAsyncTask"
    image: dd-trace-dotnet/serverless-lambda-throwing-async-task
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-throwing-async-task:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-throwing-with-context:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::ThrowingHandler"
    image: dd-trace-dotnet/serverless-lambda-throwing-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9004
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-throwing-with-context:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-throwing-async-with-context:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::ThrowingHandlerAsync"
    image: dd-trace-dotnet/serverless-lambda-throwing-async-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9004
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-throwing-async-with-context:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-throwing-async-task-with-context:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
    - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.Function::ThrowingHandlerAsyncTask"
    image: dd-trace-dotnet/serverless-lambda-throwing-async-task-with-context
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
    - SYS_PTRACE
    environment:
    - DD_TRACE_AGENT_URL=http://integrationtests:5002
    - _DD_EXTENSION_ENDPOINT=http://integrationtests:9004
    - DUMMY_API_HOST=http://serverless-dummy-api:9005
    - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
    - DD_TRACE_DEBUG=1
    - COMPlus_DbgEnableMiniDump=1
    - COMPlus_DbgMiniDumpType=4
    - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
    - DOTNET_EnableCrashReport=1
    ports:
    - "8080"
    volumes:
    - ./:/project
    - ./artifacts/build_data/logs/serverless-lambda-throwing-async-task-with-context:/var/log/datadog/dotnet
    - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation::GenericBaseType1"
    image: dd-trace-dotnet/serverless-lambda-generic
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation::GenericBaseType2"
    image: dd-trace-dotnet/serverless-lambda-generic-async
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic-async:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-virtual:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation::VirtualGenericBaseType3"
    image: dd-trace-dotnet/serverless-lambda-generic-virtual
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic-virtual:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-virtual-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation::VirtualGenericBaseType4"
    image: dd-trace-dotnet/serverless-lambda-generic-virtual-async
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic-virtual-async:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-abstract:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation::AbstractGenericBaseType5"
    image: dd-trace-dotnet/serverless-lambda-generic-abstract
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic-abstract:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-abstract-async:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation::AbstractGenericBaseType6"
    image: dd-trace-dotnet/serverless-lambda-generic-abstract-async
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic-abstract-async:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-complex:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation::ComplexNestedGeneric"
    image: dd-trace-dotnet/serverless-lambda-generic-complex
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic-complex:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-generic-complex-nested:
    build:
      context: ./artifacts/bin/Samples.AWS.Lambda
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.AWS.Lambda::Samples.AWS.Lambda.DerivedImplementation+NestedDerived::ComplexNestedGeneric"
    image: dd-trace-dotnet/serverless-lambda-generic-complex-nested
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-generic-complex-nested:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  serverless-lambda-toplevel-statement:
    build:
      context: ./artifacts/bin/Samples.Amazon.Lambda.RuntimeSupport
      dockerfile: serverless.lambda.dockerfile
      args:
        - lambdaBaseImage=${lambdaBaseImage:-public.ecr.aws/lambda/dotnet:6}
        - framework=${framework:-net6.0}
    depends_on:
      - serverless-dummy-api
    command: "Samples.Amazon.Lambda.RuntimeSupport"
    image: dd-trace-dotnet/serverless-lambda-toplevel-statement
    init: true # Without this, crash tests hang, see https://github.com/dotnet/runtime/issues/109779
    cap_add:
      - SYS_PTRACE
    environment:
      - DD_TRACE_AGENT_URL=http://integrationtests:5002
      - _DD_EXTENSION_ENDPOINT=http://integrationtests:9003
      - DUMMY_API_HOST=http://serverless-dummy-api:9005
      - DD_INSTRUMENTATION_TELEMETRY_ENABLED=0
      - DD_TRACE_DEBUG=1
      - COMPlus_DbgEnableMiniDump=1
      - COMPlus_DbgMiniDumpType=4
      - DOTNET_DbgMiniDumpName=/dumps/coredump.%t.%p
      - DOTNET_EnableCrashReport=1
    ports:
      - "8080"
    volumes:
      - ./:/project
      - ./artifacts/build_data/logs/serverless-lambda-toplevel-statement:/var/log/datadog/dotnet
      - ./artifacts/build_data/dumps:/dumps

  # The serverless function calls this API, which always returns 200 OK
  serverless-dummy-api:
    image: andrewlock/ok-api:latest
    ports:
    - "9005:9005"
    environment:
      DOTNET_URLS: "http://+:9005"
