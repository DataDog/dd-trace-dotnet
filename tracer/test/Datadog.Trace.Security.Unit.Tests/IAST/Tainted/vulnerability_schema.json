{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "IAST vulnerability events 1.0.0",
  "title": "iast",
  "type": "object",
  "properties": {
    "sources": {
      "description": "List of sources where the input data for the vulnerabilities originated (request parameters, headers ...).",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "origin": {
            "description": "Origin of the source (where the source comes from).",
            "type": "string",
            "enum": [
              "http.request.parameter",
              "http.request.parameter.name",
              "http.request.header",
              "http.request.header.name",
              "http.request.path",
              "http.request.body",
              "http.request.query",
              "http.request.path.parameter",
              "http.request.matrix.parameter",
              "http.request.cookie.name",
              "http.request.cookie.value",
              "http.request.uri",
              "grpc.request.body",
              "http.request.multipart.parameter",
              "kafka.message.key",
              "kafka.message.value",
              "graphql.resolver.argument"
            ]
          },
          "name": {
            "description": "Name of the source. For example, the name of the request parameter.",
            "type": "string"
          },
          "value": {
            "value": "Value of the source. For example, the value of the request parameter",
            "type": "string"
          },
          "redacted": {
            "value": "If the value of the source has been redacted",
            "type": "boolean"
          }
        },
        "additionalProperties": false,
        "required": [
          "origin",
          "name"
        ],
        "oneOf": [
          { "required": [ "value" ] },
          { "required": [ "redacted" ] }
        ]
      }
    },
    "vulnerabilities": {
      "description": "List of vulnerabilities found in the current execution context.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": {
            "$ref": "#/definitions/VulnerabilityType"
          },
          "hash": {
            "description": "Unique identifier for a particular vulnerability, used to deduplicate them",
            "type": "integer"
          },
          "evidence": {
            "description": "The evidence of the vulnerability describing why there is a vulnerability",
            "oneOf": [
              { "$ref": "#/definitions/StringEvidence" },
              { "$ref": "#/definitions/TaintedEvidence" }
            ]
          },
          "location": {
            "description": "The location of the vulnerability in the source code",
            "type": "object",
            "properties": {
              "spanId": {
                "description": "The ID of the active span when the vulnerability was triggered, for later use in correlation APIs",
                "type": "integer"
              },
              "path": {
                "description": "The name of the file containing the vulnerability or class name",
                "type": "string"
              },
              "line": {
                "description": "The zero based line number in the source code file where the vulnerability is located",
                "type": "integer",
                "minimum": 0
              },
              "method": {
                "description": "Name or descriptor of the method where this location points to.",
                "type": "string"
              }
            },
            "additionalProperties": false,
            "required": [
              "spanId"
            ]
          }
        },
        "additionalProperties": false,
        "required": [
          "type",
          "hash"
        ]
      }
    }
  },
  "additionalProperties": false,
  "required": [
    "vulnerabilities"
  ],
  "definitions": {
    "VulnerabilityType": {
      "description": "Type of the vulnerability",
      "type": "string",
      "enum": [
        "COMMAND_INJECTION",
        "EVAL_INJECTION",
        "DIRECTORY_LISTING_LEAK",
        "EMAIL_HTML_INJECTION",
        "HARDCODED_PASSWORD",
        "HARDCODED_SECRET",
        "HEADER_INJECTION",
        "HSTS_HEADER_MISSING",
        "INSECURE_AUTH_PROTOCOL",
        "INSECURE_COOKIE",
        "LDAP_INJECTION",
        "NOSQL_MONGODB_INJECTION",
        "NO_HTTPONLY_COOKIE",
        "NO_SAMESITE_COOKIE",
        "PATH_TRAVERSAL",
        "REFLECTION_INJECTION",
        "SESSION_TIMEOUT",
        "SQL_INJECTION",
        "SSRF",
        "STACKTRACE_LEAK",
        "TRUST_BOUNDARY_VIOLATION",
        "UNVALIDATED_REDIRECT",
        "VERB_TAMPERING",
        "WEAK_CIPHER",
        "WEAK_HASH",
        "WEAK_RANDOMNESS",
        "XCONTENTTYPE_HEADER_MISSING",
        "XPATH_INJECTION",
        "XSS"
      ]
    },
    "StringEvidence": {
      "$ref": "#/definitions/StringValue",
      "description": "Value that triggered the vulnerability. For example, crypto algorithm for insecure cipher"
    },
    "TaintedEvidence": {
      "type": "object",
      "description": "Value that triggered the vulnerability including the string value and tainted ranges",
      "properties": {
        "valueParts": {
          "description": "Each of the parts of the tainted value that triggered the vulnerability",
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/definitions/TaintedValue" },
              { "$ref": "#/definitions/StringValue" }
            ]
          }
        }
      },
      "additionalProperties": false,
      "required": [
        "valueParts"
      ]
    },
    "StringValue": {
      "type": "object",
      "properties": {
        "value": {
          "description": "String value part of the evidence",
          "type": "string"
        },
        "redacted": {
          "value": "If the current value of the evidence has been redacted",
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "oneOf": [
        { "required": [ "value" ] },
        { "required": [ "redacted" ] }
      ]
    },
    "TaintedValue": {
      "type": "object",
      "properties": {
        "value": {
          "description": "The string value that is tainted",
          "type": "string"
        },
        "source": {
          "description": "The index of the source in the sources array",
          "type": "integer"
        },
        "redacted": {
          "value": "If the current value of the evidence has been redacted",
          "type": "boolean"
        },
        "secure_marks": {
          "description": "Secure marks for evidence part",
          "type": "array",
          "items": {
            "$ref": "#/definitions/VulnerabilityType"
          }
        }
      },
      "required": [
        "source"
      ],
      "additionalProperties": false,
      "oneOf": [
        { "required": [ "value" ] },
        { "required": [ "redacted" ] }
      ]
    }
  }
}