// <copyright file="PublicApiGeneratorTests.cs" company="Datadog">
// Unless explicitly stated otherwise all files in this repository are licensed under the Apache 2 License.
// This product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2017 Datadog, Inc.
// </copyright>

using Datadog.Trace.SourceGenerators.PublicApi;
using Datadog.Trace.SourceGenerators.PublicApi.Diagnostics;
using FluentAssertions;
using FluentAssertions.Execution;
using Xunit;

namespace Datadog.Trace.SourceGenerators.Tests;

public class PublicApiGeneratorTests
{
    [Theory]
    [InlineData("=> null;")]
    [InlineData("{ get; }")]
    [InlineData("{ get; } = null;")]
    public void CanGenerateReadOnlyProperty(string definition)
    {
        var input = $$"""
            using Datadog.Trace.Configuration;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [GeneratePublicApi(PublicApiUsage.Environment_Get)]
                internal string? _Environment {{definition}}
            }
            """;

        const string expected = """
            // <auto-generated/>
            #nullable enable

            namespace MyTests.TestMetricNameSpace;
            partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public string? Environment
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return _Environment;
                    }
                }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        using var scope = new AssertionScope();
        diagnostics.Should().BeEmpty();
        output.Should().Be(expected);
    }

    [Theory]
    [InlineData("GeneratePublicApi")]
    [InlineData("GeneratePublicApiAttribute")]
    [InlineData("Datadog.Trace.SourceGenerators.GeneratePublicApiAttribute")]
    public void CanGenerateReadWriteProperty(string attributeName)
    {
        var input = $$"""
            using Datadog.Trace.Configuration;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set)]
                internal string? _Environment { get; set; }
            }
            """;

        const string expected = """
            // <auto-generated/>
            #nullable enable

            namespace MyTests.TestMetricNameSpace;
            partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public string? Environment
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return _Environment;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _Environment = value;
                    }
                }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        using var scope = new AssertionScope();
        diagnostics.Should().BeEmpty();
        output.Should().Be(expected);
    }

    [Theory]
    [InlineData("GeneratePublicApi")]
    [InlineData("GeneratePublicApiAttribute")]
    [InlineData("Datadog.Trace.SourceGenerators.GeneratePublicApiAttribute")]
    public void CanGenerateReadWritePropertyWithConfig(string attributeName)
    {
        var input = $$"""
            using Datadog.Trace.Configuration;
            using Datadog.Trace.Configuration.Telemetry;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal string? _Environment { get; set; }
            }
            """;

        var expected = $$"""
            // <auto-generated/>
            #nullable enable

            namespace MyTests.TestMetricNameSpace;
            partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public string? Environment
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return _Environment;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", value, recordValue: true, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        _Environment = value;
                    }
                }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        using var scope = new AssertionScope();
        diagnostics.Should().BeEmpty();
        output.Should().Be(expected);
    }

    [Theory]
    [InlineData("GeneratePublicApi")]
    [InlineData("GeneratePublicApiAttribute")]
    [InlineData("Datadog.Trace.SourceGenerators.GeneratePublicApiAttribute")]
    public void CanGenerateForMultipleReturnTypes(string attributeName)
    {
        var input = $$"""
            using System.Collections.Generic;
            using Datadog.Trace.Configuration;
            using Datadog.Trace.Configuration.Telemetry;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal string? StringTestInternal { get; set; }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal bool BoolTestInternal { get; set; }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal int IntTestInternal { get; set; }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal double DoubleTestInternal { get; set; }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal double? NullableDoubleTestInternal { get; set; }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal HashSet<string> HashSetTestInternal { get; set; }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal Dictionary<string, string> DictionaryTestInternal { get; set; }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [{{attributeName}}(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, "some_key")]
                internal IDictionary<string, string> IDictionaryTestInternal { get; set; }
                
            }
            """;

        var expected = $$"""
            // <auto-generated/>
            #nullable enable

            namespace MyTests.TestMetricNameSpace;
            partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public string? StringTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return StringTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", value, recordValue: true, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        StringTestInternal = value;
                    }
                }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public bool BoolTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return BoolTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", value, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        BoolTestInternal = value;
                    }
                }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public int IntTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return IntTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", value, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        IntTestInternal = value;
                    }
                }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public double DoubleTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return DoubleTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", value, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        DoubleTestInternal = value;
                    }
                }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public double? NullableDoubleTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return NullableDoubleTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", value, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        NullableDoubleTestInternal = value;
                    }
                }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public System.Collections.Generic.HashSet<string> HashSetTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return HashSetTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", string.Join(";", value), recordValue: true, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        HashSetTestInternal = value;
                    }
                }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public System.Collections.Generic.Dictionary<string, string> DictionaryTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return DictionaryTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", string.Join(",", System.Linq.Enumerable.Select(value, kvp => $"{kvp.Key}:{kvp.Value}")), recordValue: true, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        DictionaryTestInternal = value;
                    }
                }

                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public System.Collections.Generic.IDictionary<string, string> IDictionaryTest
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return IDictionaryTestInternal;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _telemetry.Record("some_key", string.Join(",", System.Linq.Enumerable.Select(value, kvp => $"{kvp.Key}:{kvp.Value}")), recordValue: true, Datadog.Trace.Configuration.Telemetry.ConfigurationOrigins.Code);
                        IDictionaryTestInternal = value;
                    }
                }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        using var scope = new AssertionScope();
        diagnostics.Should().BeEmpty();
        output.Should().Be(expected);
    }

    [Fact]
    public void CanGenerateMultipleProperties()
    {
        const string input = """
            using Datadog.Trace.Configuration;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [GeneratePublicApi(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set)]
                internal string? _Environment { get; set; }

                /// <summary>
                /// Gets the default service name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Service"/>
                [GeneratePublicApi(PublicApiUsage.ServiceName_Get)]
                internal HashSet<string> ServiceNameInternal { get; }
            }
            """;

        const string expected = """
            // <auto-generated/>
            #nullable enable

            namespace MyTests.TestMetricNameSpace;
            partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public string? Environment
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)0);
                        return _Environment;
                    }
                    set
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)1);
                        _Environment = value;
                    }
                }

                /// <summary>
                /// Gets the default service name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Service"/>
                [Datadog.Trace.SourceGenerators.PublicApi]
                public HashSet<string> ServiceName
                {
                    get
                    {
                        Datadog.Trace.Telemetry.TelemetryFactory.Metrics.Record(
                            (Datadog.Trace.Telemetry.Metrics.PublicApiUsage)2);
                        return ServiceNameInternal;
                    }
                }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        using var scope = new AssertionScope();
        diagnostics.Should().BeEmpty();
        output.Should().Be(expected);
    }

    [Theory]
    [InlineData("struct")]
    [InlineData("record struct")]
    public void CanNotGenerateForStruct(string type)
    {
        var input = $$"""
            using Datadog.Trace.Configuration;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial {{type}} TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [GeneratePublicApi(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set)]
                internal string? _Environment { get; set; }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        Assert.Contains(diagnostics, diag => diag.Id == OnlySupportsClassesDiagnostic.Id);
    }

    [Theory]
    [InlineData("=> null;")]
    [InlineData("{ get; }")]
    [InlineData("{ get; } = null;")]
    public void CanNotGenerateSetterForReadOnlyProperty(string definition)
    {
        var input = $$"""
            using Datadog.Trace.Configuration;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [GeneratePublicApi(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set)]
                internal string? _Environment {{definition}}
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        Assert.Contains(diagnostics, diag => diag.Id == SetterOnReadonlyFieldDiagnostic.Id);
    }

    [Fact]
    public void ErrorsWhenCantDetermineName()
    {
        var input = """
            using Datadog.Trace.Configuration;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [GeneratePublicApi(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set)]
                internal string? Environment { get; set; }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        Assert.Contains(diagnostics, diag => diag.Id == NamingProblemDiagnostic.Id);
    }

    [Theory]
    [InlineData("null")]
    [InlineData("\"\"")]
    public void ErrorsWhenNullOrEmptyTelemetryStrings(string config)
    {
        var input = $$"""
            using Datadog.Trace.Configuration;
            using Datadog.Trace.Configuration.Telemetry;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public partial class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [GeneratePublicApi(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set, {{config}})]
                internal string? _Environment { get; set; }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        Assert.Contains(diagnostics, diag => diag.Id == EmptyStringDiagnostic.Id);
    }

    [Fact]
    public void AddsDiagnosticWhenPartialModifierMissing()
    {
        var input = """
            using Datadog.Trace.Configuration;
            using Datadog.Trace.SourceGenerators;
            using Datadog.Trace.Telemetry.Metrics;

            #nullable enable
            namespace MyTests.TestMetricNameSpace;
            public class TestSettings
            {
                /// <summary>
                /// Gets the default environment name applied to all spans.
                /// </summary>
                /// <seealso cref="ConfigurationKeys.Environment"/>
                [GeneratePublicApi(PublicApiUsage.Environment_Get, PublicApiUsage.Environment_Set)]
                internal string? Environment { get; set; }
            }
            """;

        var (diagnostics, output) = TestHelpers.GetGeneratedOutput<PublicApiGenerator>(input, GetPublicApiAttribute());
        Assert.Contains(diagnostics, diag => diag.Id == PartialModifierIsRequiredDiagnostic.Id);
    }

    private static string GetPublicApiAttribute()
        => """
            namespace Datadog.Trace.Telemetry.Metrics;
            public enum PublicApiUsage 
            {
                Environment_Get,
                Environment_Set,
                ServiceName_Get,
            }
            """;
}
