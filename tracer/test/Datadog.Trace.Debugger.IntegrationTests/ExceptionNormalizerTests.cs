// <copyright file="ExceptionNormalizerTests.cs" company="Datadog">
// Unless explicitly stated otherwise all files in this repository are licensed under the Apache 2 License.
// This product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2017 Datadog, Inc.
// </copyright>

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Text;
using System.Threading.Tasks;
using Datadog.Trace.Debugger.Configurations.Models;
using Datadog.Trace.Debugger.ExceptionAutoInstrumentation;
using Datadog.Trace.Debugger.IntegrationTests.Helpers;
using Datadog.Trace.Debugger.Models;
using FluentAssertions;
using Samples.Probes.TestRuns.SmokeTests;
using VerifyTests;
using VerifyXunit;
using Xunit;
using Xunit.Abstractions;

#nullable enable
namespace Datadog.Trace.Debugger.IntegrationTests
{
    [UsesVerify]
    public class ExceptionNormalizerTests
    {
        private readonly ITestOutputHelper _testOutputHelper;

        public ExceptionNormalizerTests(ITestOutputHelper testOutputHelper)
        {
            _testOutputHelper = testOutputHelper;
        }

        [Theory]
        [InlineData(1, "Microsoft.Data.SqlClient.SqlException (0x80131904): Execution Timeout Expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\r\n ---> System.ComponentModel.Win32Exception (258): Unknown error 258\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Datadog.Trace.ClrProfiler.CallTarget.Handlers.Continuations.TaskContinuationGenerator`4.SyncCallbackHandler.ContinuationAction(Task`1 previousTask, TTarget target, CallTargetState state) in /project/tracer/src/Datadog.Trace/ClrProfiler/CallTarget/Handlers/Continuations/TaskContinuationGenerator`1.cs:line 140\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 786\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 801\r\n   at Foo.Bar.Backend.Controllers.WorkOrdersController.GetStats(GetWorkOrderStatsRequestFooApi request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/WorkOrdersController.cs:line 138\r\n   at lambda_method6365(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 57\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35\r\nClientConnectionId:XXX\r\nError Number:-2,State:0,Class:11", "Microsoft.Data.SqlClient.SqlException", "System.ComponentModel.Win32Exception")]
        [InlineData(2, "Microsoft.Data.SqlClient.SqlException (0x80131904): Another Exception, SqlException.  Another exception..... \r\n ---> System.ComponentModel.Win32Exception (258): Unknown error 258\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Datadog.Trace.ClrProfiler.CallTarget.Handlers.Continuations.TaskContinuationGenerator`4.SyncCallbackHandler.ContinuationAction(Task`1 previousTask, TTarget target, CallTargetState state) in /project/tracer/src/Datadog.Trace/ClrProfiler/CallTarget/Handlers/Continuations/TaskContinuationGenerator`1.cs:line 140\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 786\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 500\r\n   at Foo.Bar.Backend.Controllers.WorkOrdersController.GetStats(GetWorkOrderStatsRequestFooApi request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/WorkOrdersController.cs:line 138\r\n   at lambda_method6365(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 57\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35\r\nBLablalbalbClientConnectionId:XXX\r\nMessage Messag Message", "Microsoft.Data.SqlClient.SqlException", "System.ComponentModel.Win32Exception")]
        [InlineData(3, "Microsoft.Data.SqlClient.SqlException (0x80131904): Another Exception, SqlException.  Another exception..... \r\n ---> System.ComponentModel.Win32Exception (258): Unknown error 258\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Datadog.Trace.ClrProfiler.CallTarget.Handlers.Continuations.TaskContinuationGenerator`4.SyncCallbackHandler.ContinuationAction(Task`1 previousTask, TTarget target, CallTargetState state) in /project/tracer/src/Datadog.Trace/ClrProfiler/CallTarget/Handlers/Continuations/TaskContinuationGenerator`1.cs:line 140\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 786\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 500\r\n   at Foo.Bar.Backend.Controllers.WorkOrdersController.GetStats(GetWorkOrderStatsRequestFooApi request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/WorkOrdersController.cs:line 138\r\n   at lambda_method6365(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 57\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35\r\nBLablalbalbClientConnectionId:XXX\r\nMessage Messag Message", "Microsoft.Data.SqlClient.SqlException", null)]
        [InlineData(4, "Microsoft.Data.SqlClient.SqlException (0x80131904): Another Exception, SqlException.  Another exception..... \r\n ---> System.ComponentModel.Win32Exception (258): Unknown error 258\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Datadog.Trace.ClrProfiler.CallTarget.Handlers.Continuations.TaskContinuationGenerator`4.SyncCallbackHandler.ContinuationAction(Task`1 previousTask, TTarget target, CallTargetState state) in /project/tracer/src/Datadog.Trace/ClrProfiler/CallTarget/Handlers/Continuations/TaskContinuationGenerator`1.cs:line 140\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 786\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 500\r\n   at Foo.Bar.Backend.Controllers.WorkOrdersController.GetStats(GetWorkOrderStatsRequestFooApi request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/WorkOrdersController.cs:line 138\r\n   at lambda_method6365(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 57\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35\r\nBLablalbalbClientConnectionId:XXX\r\nMessage Messag Message", "Microsoft.Data.SqlClient.SqlException2", null)]
        [InlineData(5, "Microsoft.Data.SqlClient.SqlException (BlaBlaBla): Another Exception, SqlException.  Another exception..... \r\n ---> System.ComponentModel.Win32Exception (258): Unknown error 258\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Datadog.Trace.ClrProfiler.CallTarget.Handlers.Continuations.TaskContinuationGenerator`4.SyncCallbackHandler.ContinuationAction(Task`1 previousTask, TTarget target, CallTargetState state) in /project/tracer/src/Datadog.Trace/ClrProfiler/CallTarget/Handlers/Continuations/TaskContinuationGenerator`1.cs:line 140\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 786\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 500\r\n   at Foo.Bar.Backend.Controllers.WorkOrdersController.GetStats(GetWorkOrderStatsRequestFooApi request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/WorkOrdersController.cs:line 138\r\n   at lambda_method6365(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 57\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35\r\nBLablalbalbClientConnectionId:XXX\r\nMessage Messag Message", "Microsoft.Data.SqlClient.SqlException2", "System.ComponentModel.Win32Exception")]
        [InlineData(6, "Microsoft.Data.SqlClient.SqlException (BlaBlaBla2): Another Exception, SqlException.  Another exception..... \r\n ---> System.ComponentModel.Win32Exception (258): Unknown error 258\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Datadog.Trace.ClrProfiler.CallTarget.Handlers.Continuations.TaskContinuationGenerator`4.SyncCallbackHandler.ContinuationAction(Task`1 previousTask, TTarget target, CallTargetState state) in /project/tracer/src/Datadog.Trace/ClrProfiler/CallTarget/Handlers/Continuations/TaskContinuationGenerator`1.cs:line 140\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 786\r\n   at Foo.Bar.Core.App.WorkOrders.GetStats(Int32 associationId, Nullable`1 accountNumber, String unitNumber, String categoryName, List`1 associationIds) in /builds/programmers/foo-api/Foo.Bar.Core/App/WorkOrders.cs:line 500\r\n   at Foo.Bar.Backend.Controllers.WorkOrdersController.GetStats(GetWorkOrderStatsRequestFooApi request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/WorkOrdersController.cs:line 138\r\n   at lambda_method6365(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 57\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35\r\nBLablalbalbClientConnectionId:XXX\r\nMessage Messag Message", "Microsoft.Data.SqlClient.SqlException2", null)]
        [InlineData(7, "System.NullReferenceException: Object reference not set to an instance of an object.\r\n   at MyApp.Services.UserService.GetUserById(Int32 id) in C:\\Projects\\MyApp\\Services\\UserService.cs:line 45\r\n   at MyApp.Controllers.UserController.GetUser(Int32 id) in C:\\Projects\\MyApp\\Controllers\\UserController.cs:line 25\r\n   at lambda_method(Closure , Object , Object[] )", "System.NullReferenceException", null)]
        [InlineData(8, "System.InvalidOperationException: Operation is not valid due to the current state of the object.\r\n   at MyApp.Data.DatabaseContext.SaveChanges() in /src/MyApp/Data/DatabaseContext.cs:line 120\r\n   at MyApp.Services.UserService.CreateUser(User user) in /src/MyApp/Services/UserService.cs:line 75\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Services.UserService.CreateUser(User user) in /src/MyApp/Services/UserService.cs:line 100", "System.InvalidOperationException", null)]
        [InlineData(9, "System.ArgumentNullException: Value cannot be null.\r\nParameter name: user\r\n   at MyApp.Services.UserService.UpdateUser(User user) in D:\\Code\\MyApp\\Services\\UserService.cs:line 110\r\n   at MyApp.Controllers.UserController.UpdateUser(User user) in D:\\Code\\MyApp\\Controllers\\UserController.cs:line 35", "System.ArgumentNullException", null)]
        [InlineData(10, "System.FormatException: Input string was not in a correct format.\r\n   at System.Number.StringToNumber(ReadOnlySpan`1 str, NumberStyles options, NumberBuffer& number, NumberFormatInfo info, Boolean parseDecimal)\r\n   at System.Number.ParseInt32(ReadOnlySpan`1 s, NumberStyles style, NumberFormatInfo info)\r\n   at MyApp.Utilities.StringExtensions.ToInt32(String input) in /opt/myapp/src/Utilities/StringExtensions.cs:line 50", "System.FormatException", null)]
        [InlineData(11, "System.AggregateException: One or more errors occurred.\r\n   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)\r\n   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Controllers.UserController.CreateUserAsync(User user) in /src/MyApp/Controllers/UserController.cs:line 80\r\n ---> System.Net.Http.HttpRequestException: An error occurred while sending the request.\r\n   at System.Net.Http.HttpClient.SendAsync(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationToken cancellationToken)", "System.AggregateException", "System.Net.Http.HttpRequestException")]
        [InlineData(12, "System.Exception: A general error occurred.\r\n   at MyApp.Program.Main(String[] args) in /app/MyApp/Program.cs:line 10", "System.Exception", null)]
        [InlineData(13, "System.IO.FileNotFoundException: Could not load file or assembly 'SomeLibrary'.\r\n   at MyApp.Services.FileService.ReadFile(String path) in /home/user/MyApp/Services/FileService.cs:line 65", "System.IO.FileNotFoundException", null)]
        [InlineData(14, "System.InvalidCastException: Unable to cast object of type 'System.String' to type 'System.Int32'.\r\n   at MyApp.Models.User.set_Age(Object value) in /var/myapp/Models/User.cs:line 20", "System.InvalidCastException", null)]
        [InlineData(15, "System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.\r\n   at MyApp.Services.LargeDataProcessor.ProcessLargeData() in /mnt/data/MyApp/Services/LargeDataProcessor.cs:line 200", "System.OutOfMemoryException", null)]
        [InlineData(16, "System.Threading.Tasks.TaskCanceledException: A task was canceled.\r\n   at MyApp.Services.HttpService.GetDataAsync(String url) in /app/MyApp/Services/HttpService.cs:line 150\r\n   at MyApp.Controllers.DataController.GetData(String id) in /app/MyApp/Controllers/DataController.cs:line 45", "System.Threading.Tasks.TaskCanceledException", null)]
        [InlineData(17, "System.InvalidOperationException: The operation is invalid.\r\n   at MyApp.Services.UserService.GetUserById(Int32 id) in C:\\Projects\\MyApp\\Services\\UserService.cs:line 50\r\n   at MyApp.Controllers.UserController.GetUser(Int32 id) in C:\\Projects\\MyApp\\Controllers\\UserController.cs:line 30\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Middleware.LoggingMiddleware.Invoke(HttpContext context) in C:\\Projects\\MyApp\\Middleware\\LoggingMiddleware.cs:line 40\r\n ---> System.NullReferenceException: Object reference not set to an instance of an object.\r\n   at MyApp.Services.UserService.FindUser(String name) in C:\\Projects\\MyApp\\Services\\UserService.cs:line 100", "System.InvalidOperationException", "System.NullReferenceException")]
        [InlineData(18, "System.ArgumentException: The argument is invalid.\r\n   at MyApp.Data.DatabaseContext.GetUserById(Int32 id) in /src/MyApp/Data/DatabaseContext.cs:line 120\r\n   at MyApp.Services.UserService.CreateUser(User user) in /src/MyApp/Services/UserService.cs:line 85\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Controllers.UserController.CreateUser(User user) in /src/MyApp/Controllers/UserController.cs:line 45\r\n ---> System.InvalidOperationException: Cannot create user due to database state.\r\n   at MyApp.Data.DatabaseContext.SaveChanges() in /src/MyApp/Data/DatabaseContext.cs:line 150", "System.ArgumentException", "System.InvalidOperationException")]
        [InlineData(19, "System.FormatException: The format is incorrect.\r\n   at System.Number.StringToNumber(ReadOnlySpan`1 str, NumberStyles options, NumberBuffer& number, NumberFormatInfo info, Boolean parseDecimal)\r\n   at System.Number.ParseInt32(ReadOnlySpan`1 s, NumberStyles style, NumberFormatInfo info)\r\n   at MyApp.Utilities.StringExtensions.ToInt32(String input) in /opt/myapp/src/Utilities/StringExtensions.cs:line 70\r\n   at MyApp.Controllers.DataController.ConvertStringToInt(String value) in /opt/myapp/src/Controllers/DataController.cs:line 50", "System.FormatException", null)]
        [InlineData(20, "System.InvalidOperationException: Operation failed due to invalid state.\r\n   at MyApp.Controllers.HomeController.Index() in D:\\Web\\MyApp\\Controllers\\HomeController.cs:line 30\r\n   at Microsoft.AspNetCore.Mvc.ViewResultExecutor.Execute(ViewContext viewContext, String contentPath) in /home/user/.dotnet/sdk/NuGetFallbackFolder/microsoft.aspnetcore.mvc.viewfeatures/2.1.1/lib/netstandard2.0/Microsoft.AspNetCore.Mvc.ViewFeatures.dll:line 100\r\n ---> System.Data.SqlClient.SqlException: Timeout expired.\r\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) in /_/src/Microsoft.Data.SqlClient.SqlClient/SqlConnection.cs:line 750", "System.InvalidOperationException", "System.Data.SqlClient.SqlException")]
        [InlineData(21, "System.AggregateException: One or more errors occurred.\r\n   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)\r\n   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Controllers.FileController.UploadFileAsync(IFormFile file) in /src/MyApp/Controllers/FileController.cs:line 60\r\n ---> System.IO.IOException: The file cannot be accessed.\r\n   at MyApp.Services.FileService.SaveFile(String path, IFormFile file) in /src/MyApp/Services/FileService.cs:line 90", "System.AggregateException", "System.IO.IOException")]
        [InlineData(22, "System.NullReferenceException: Object reference not set to an instance of an object.\r\n   at MyApp.Services.CustomerService.GetCustomerDetails(Int32 customerId) in C:\\Code\\MyApp\\Services\\CustomerService.cs:line 100\r\n   at MyApp.Controllers.CustomerController.GetCustomer(Int32 id) in C:\\Code\\MyApp\\Controllers\\CustomerController.cs:line 50", "System.NullReferenceException", null)]
        [InlineData(23, "System.InvalidOperationException: Invalid operation attempted.\r\n   at MyApp.Services.OrderService.ProcessOrder(Int32 orderId) in /home/user/MyApp/Services/OrderService.cs:line 120\r\n   at MyApp.Controllers.OrderController.CompleteOrder(Int32 id) in /home/user/MyApp/Controllers/OrderController.cs:line 60\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /home/user/MyApp/Middleware/ErrorHandlingMiddleware.cs:line 40\r\n ---> System.NullReferenceException: Object reference not set to an instance of an object.\r\n   at MyApp.Services.OrderService.ValidateOrder(Order order) in /home/user/MyApp/Services/OrderService.cs:line 200", "System.InvalidOperationException", "System.NullReferenceException")]
        [InlineData(24, "System.ArgumentOutOfRangeException: Index was out of range. Must be non-negative and less than the size of the collection.\r\nParameter name: index\r\n   at MyApp.Collections.CustomList`1.get_Item(Int32 index) in /mnt/data/MyApp/Collections/CustomList.cs:line 80\r\n   at MyApp.Controllers.CollectionController.GetItem(Int32 index) in /mnt/data/MyApp/Controllers/CollectionController.cs:line 45", "System.ArgumentOutOfRangeException", null)]
        [InlineData(25, "System.InvalidOperationException: The operation failed.\r\n   at MyApp.Services.UserService.GetUserById(Int32 id) in C:\\Projects\\MyApp\\Services\\UserService.cs:line 45\r\n   at MyApp.Controllers.UserController.GetUser(Int32 id) in C:\\Projects\\MyApp\\Controllers\\UserController.cs:line 25\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Middleware.LoggingMiddleware.Invoke(HttpContext context) in C:\\Projects\\MyApp\\Middleware\\LoggingMiddleware.cs:line 35\r\n ---> System.NullReferenceException: Object reference not set to an instance of an object.\r\n   at MyApp.Services.UserService.FindUser(String name) in C:\\Projects\\MyApp\\Services\\UserService.cs:line 95", "System.InvalidOperationException", "System.NullReferenceException")]
        [InlineData(26, "System.ArgumentException: Invalid argument.\r\n   at MyApp.Services.ValidationService.Validate(Object value) in D:\\Projects\\MyApp\\Services\\ValidationService.cs:line 55\r\n   at MyApp.Controllers.ValidationController.ValidateInput(Object input) in D:\\Projects\\MyApp\\Controllers\\ValidationController.cs:line 35\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in D:\\Projects\\MyApp\\Middleware\\ErrorHandlingMiddleware.cs:line 45\r\n ---> System.NullReferenceException: Value cannot be null.\r\n   at MyApp.Services.ValidationService.CheckNull(Object value) in D:\\Projects\\MyApp\\Services\\ValidationService.cs:line 75", "System.ArgumentException", "System.NullReferenceException")]
        [InlineData(27, "System.InvalidOperationException: Cannot execute operation.\r\n   at MyApp.Data.DbContext.ExecuteCommand(String command) in /var/www/MyApp/Data/DbContext.cs:line 90\r\n   at MyApp.Services.CommandService.RunCommand(String command) in /var/www/MyApp/Services/CommandService.cs:line 40\r\n--- End of stack trace from previous location ---\r\n   at MyApp.Controllers.CommandController.ExecuteCommand(String command) in /var/www/MyApp/Controllers/CommandController.cs:line 30\r\n ---> System.Data.SqlClient.SqlException: SQL execution failed.\r\n   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery() in /_/src/Microsoft.Data.SqlClient.SqlCommand.cs:line 500", "System.InvalidOperationException", "System.Data.SqlClient.SqlException")]
        [InlineData(28, "Foo.Bar.Models.Exceptions.FOOException: The invoice number already exists\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.ValidateTransactions() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 267\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.CreatePayableInvoice() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 40\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.CreatePayableInvoice() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 87\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 571\r\n--- End of stack trace from previous location ---\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 572\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 575\r\n   at Foo.Bar.Backend.Controllers.TransactionsController.CreatePayableWithFiles(PayableRequest request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/TransactionsController.cs:line 53\r\n   at lambda_method7658(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 56\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35", "Foo.Bar.Models.Exceptions.FOOException", null)]
        [InlineData(29, "Foo.Bar.Models.Exceptions.FOOException: The XXX has payments. It cannot be modified\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.ValidateTransactions() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 268\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.EditPayableInvoice() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 105\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 571\r\n--- End of stack trace from previous location ---\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 572\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 575\r\n   at Foo.Bar.Backend.Controllers.TransactionsController.EditPayableWithFiles(PayableRequest request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/TransactionsController.cs:line 104\r\n   at lambda_method11253(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 56\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35", "Foo.Bar.Models.Exceptions.FOOException", null)]
        [InlineData(30, "Foo.Bar.Models.Exceptions.FOOException: The transaction is outside of the financial year.\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.ValidateTransactions() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 266\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.CreatePayableInvoice() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 38\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.CreatePayableInvoice() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 87\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 571\r\n--- End of stack trace from previous location ---\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 572\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 575\r\n   at Foo.Bar.Backend.Controllers.TransactionsController.CreatePayableWithFiles(PayableRequest request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/TransactionsController.cs:line 53\r\n   at lambda_method9440(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 56\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35", "Foo.Bar.Models.Exceptions.FOOException", null)]
        [InlineData(31, "Foo.Bar.Models.Exceptions.FOOException: The YYY has payments. It cannot be modified\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.ValidateTransactions() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 268\r\n   at Foo.Bar.Core.Core.Transactions.PayableInvoiceTransaction.EditPayableInvoice() in /builds/programmers/foo-api/Foo.Bar.Core/Core/Transactions/PayableInvoiceTransaction.cs:line 105\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 571\r\n--- End of stack trace from previous location ---\r\n   at Foo.Bar.Core.App.Transactions.<>c__DisplayClass17_0.<<CreatePayableInvoice>b__1>d.MoveNext() in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 572\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 574\r\n   at Foo.Bar.Core.App.Transactions.CreatePayableInvoice(PayableRequest request, Boolean isEdit) in /builds/programmers/foo-api/Foo.Bar.Core/App/Transactions.cs:line 575\r\n   at Foo.Bar.Backend.Controllers.TransactionsController.EditPayableWithFiles(PayableRequest request) in /builds/programmers/foo-api/Foo.Bar.Backend/Controllers/TransactionsController.cs:line 104\r\n   at lambda_method11253(Closure, Object)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Foo.Bar.Backend.Middleware.GetCompanyMiddleware.Invoke(HttpContext httpContext, ISessionCache sessionCache, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/GetCompanyMiddleware.cs:line 61\r\n   at Foo.Bar.Backend.Middleware.CheckRouteMiddleware.Invoke(HttpContext context, IApiFunctions api) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckRouteMiddleware.cs:line 28\r\n   at Foo.Bar.Backend.Middleware.CheckAccessMiddleware.Invoke(HttpContext context, IApiFunctions api, IConfiguration config) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/CheckAccessMiddleware.cs:line 56\r\n   at Datadog.Trace.ClrProfiler.AutoInstrumentation.AspNetCore.BlockingMiddleware.Invoke(HttpContext context) in /project/tracer/src/Datadog.Trace/ClrProfiler/AutoInstrumentation/AspNetCore/BlockingMiddleware.cs:line 115\r\n   at Foo.Bar.Backend.Middleware.ErrorHandlingMiddleware.Invoke(HttpContext context) in /builds/programmers/foo-api/Foo.Bar.Backend/Middleware/ErrorHandlingMiddleware.cs:line 35", "Foo.Bar.Models.Exceptions.FOOException", null)]
        [InlineData(32, "System.Exception: can't book a room without course ID\r\n   at WebService.Controllers.RoomsController.BookRoom(String id, String course)\r\n   at lambda_method347(Closure, Object, Object[])\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)\r\n   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)\r\n   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)\r\n   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)\r\n", "System.Exception", null)]
        [InlineData(33, "System.Exception: can't book a room without course ID\r\n   at WebService.Controllers.RoomsController.BookRoom(String id, String course)\r\n   at lambda_method254(Closure, Object, Object[])\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Logged|12_1(ControllerActionInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)\r\n   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)\r\n   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)\r\n   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)\r\n   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)\r\n", "System.Exception", null)]
        public async Task HashExceptionToStringTest(int index, string exceptionToString, string outerExceptionType, string? innerExceptionType)
        {
            var exceptionNormalizer = new TestExceptionNormalizer();
            var debug = new StringBuilder();

            var stopWatch = Stopwatch.StartNew();
            var hash = exceptionNormalizer.NormalizeAndHashException(exceptionToString, outerExceptionType, innerExceptionType, debug);
            stopWatch.Stop();

            var elapsedMicroseconds = stopWatch.ElapsedTicks * (1000000.0 / Stopwatch.Frequency);
            _testOutputHelper.WriteLine($"Execution Time: {stopWatch.ElapsedMilliseconds} ms. Microseconds: {elapsedMicroseconds} µs");

            debug.AppendLine("Resulting Hash: " + hash);

            var settings = new VerifySettings();
            settings.UseFileName($"{nameof(ExceptionNormalizerTests)}.{index}");
            await Verifier.Verify(debug.ToString(), settings);
        }
    }
}
