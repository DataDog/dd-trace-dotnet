# RabbitMQ Instrumentation
The .NET Tracer has out-of-the-box automatic instrumentation for the RabbitMQ .NET SDK which means you will automatically get producer and consumer spans in your traces. However, the consumer span is short lived, as the `BasicGet` integration creates a scope and immediately disposes it. 

Depending how you consume the message locally, spans generated by your consumers will be disconnected from the producer and consumer spans. To ensure they stay connected, we provide an API to manually extract the distributed context from a message which you can use to create the child span.

## Setup
### Application setup
This sample contains two .NET Core applications: `Send` and `Receive`. Open two terminals. First, run the consumer:

```
cd Receive
dotnet run
```

Then run the producer:
```
cd Send
dotnet run
```

For further tutorial instructions, see the official RabbitMQ docs at https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html

### RabbitMQ setup
Ensure RabbitMQ is running on localhost. If you have docker installed, you may get it up and running quickly on your workstation via the community Docker image:

```
docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management
```

For further setup instructions, see the official RabbitMQ docs at https://www.rabbitmq.com/download.html

## Results
![Datadog UI with one RabbitMQ producer span and one RabbitMQ consumer span](https://user-images.githubusercontent.com/13769665/94503633-be690d80-01bb-11eb-8a4c-ccb4a5ee5b82.png)