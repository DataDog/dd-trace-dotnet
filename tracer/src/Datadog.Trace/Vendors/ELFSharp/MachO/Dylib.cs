//------------------------------------------------------------------------------
// <auto-generated />
// This file was automatically generated by the UpdateVendoredCode tool.
//------------------------------------------------------------------------------
#pragma warning disable CS0618, CS0649, CS1574, CS1580, CS1581, CS1584, CS1591, CS1573, CS8018, CS1587, SYSLIB0011, SYSLIB0023, SYSLIB0032
#if NETCOREAPP3_1_OR_GREATER
using System;
using System.IO;
using System.Text;
using Datadog.Trace.Vendors.ELFSharp.Utilities;

namespace Datadog.Trace.Vendors.ELFSharp.MachO
{
    internal abstract class Dylib : Command
    {
        internal Dylib(SimpleEndianessAwareReader reader, Stream stream, uint commandSize) : base(reader, stream)
        {
            var offset = reader.ReadUInt32();
            var timestamp = reader.ReadInt32();
            var currentVersion = reader.ReadUInt32();
            var compatibilityVersion = reader.ReadUInt32();
            Timestamp = DateTimeOffset.FromUnixTimeSeconds(timestamp).UtcDateTime;
            CurrentVersion = GetVersion(currentVersion);
            CompatibilityVersion = GetVersion(compatibilityVersion);
            Name = GetString(reader.ReadBytes((int)(commandSize - offset)));
        }

        public string Name { get; }
        public DateTime Timestamp { get; }
        public Version CurrentVersion { get; }
        public Version CompatibilityVersion { get; }

        private static Version GetVersion(uint version)
        {
            return new Version((int)(version >> 16), (int)((version >> 8) & 0xff), (int)(version & 0xff));
        }

        private static string GetString(byte[] bytes)
        {
            var nullTerminatorIndex = Array.FindIndex(bytes, e => e == '\0');
            return Encoding.ASCII.GetString(bytes, 0, nullTerminatorIndex >= 0 ? nullTerminatorIndex : bytes.Length);
        }
    }
}
#endif