// <copyright file="Vulnerability.cs" company="Datadog">
// Unless explicitly stated otherwise all files in this repository are licensed under the Apache 2 License.
// This product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2017 Datadog, Inc.
// </copyright>

#nullable enable

using Datadog.Trace.Configuration;
using Datadog.Trace.Vendors.Newtonsoft.Json;
using Datadog.Trace.Vendors.Newtonsoft.Json.Converters;

namespace Datadog.Trace.Iast;

internal readonly struct Vulnerability
{
    private readonly IntegrationId? _integrationId;
    private readonly int? _fixedhash = null;

    public Vulnerability(string type, Location location, Evidence evidence, IntegrationId? integrationId = null)
    {
        this.Type = type;
        this.Location = location;
        this.Evidence = evidence;
        this._integrationId = integrationId;
    }

    public Vulnerability(string type, int hash, Evidence evidence, IntegrationId? integrationId = null)
    {
        this.Type = type;
        this._fixedhash = hash;
        this.Evidence = evidence;
        this._integrationId = integrationId;
    }

    public string Type { get;  }

    public int Hash => GetHashCode();

    public Location Location { get; }

    public Evidence Evidence { get; }

    internal IntegrationId? GetIntegrationId() => _integrationId;

    public override int GetHashCode()
    {
        // We do not calculate the hash according to the evidence
        return _fixedhash ?? IastUtils.GetHashCode(Type, Location);
    }
}
