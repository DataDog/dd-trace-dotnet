parameters:
  - name: 'checkName'
    type: string

  - name: 'status'
    type: string

  - name: 'description'
    type: string

steps:
- script: |
    TARGET_URL="https://dev.azure.com/datadoghq/$(PROJECT_NAME)/_build/results?buildId=$(Build.BuildId)"
    curl -X POST \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Authorization: Bearer $(GITHUB_TOKEN)" \
    https://api.github.com/repos/DataDog/$(REPOSITORY_NAME)/statuses/$(OriginalCommitId) \
    -d '{"state":"${{ parameters.status }}","context":"${{ parameters.checkName }}","description":"${{ parameters.description }}","target_url":"'"$TARGET_URL"'"}'
  displayName: Set GitHub Status ${{ parameters.status }}
  condition: and(succeededOrFailed(), ne(variables['Build.BuildId'], ''))
  continueOnError: true
  env:
    PROJECT_NAME: $(AZURE_PROJECT_NAME)
    GITHUB_TOKEN: $(GITHUB_TOKEN)
    REPOSITORY_NAME: $(GITHUB_REPOSITORY_NAME)
